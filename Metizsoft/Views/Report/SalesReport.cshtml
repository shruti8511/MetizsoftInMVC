@model Metizsoft.Data.ViewModal.SalesTargetResponse

@{
    ViewBag.Title = "SalesReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="box box-default">
    <div class="box-header with-border">
        <h3 class="box-title">Sales Report</h3>
    </div>
    <form class="form-horizontal" id="frmsalesreport">
        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">

                <div class="col-md-12">
                    <input name="Id" id="Id" type="hidden" value="" />
                    <input name="UserRoleID" id="UserRoleID" type="hidden" value="" />
                    <input name="Id" id="Id" type="hidden" value="" />
                  
                    <div class="col-md-5">
                        <div class="form-group" id="divdirctor">
                            <label for="inputPassword3" class="col-sm-4 control-label">Director</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.DirectorID, new SelectList(ViewBag.UserByRoleDirector, "UserID", "UserFullName", Session["UserID"]), "Select Director", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <input name="VP" id="VP" type="hidden" value=""  />
                        <div class="form-group" id="divvp">
                            <label for="inputPassword3" class="col-sm-4 control-label">VP</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.VPID, new SelectList(ViewBag.UserByRoleVP, "UserID", "UserFullName", Session["UserID"]), "Select VP", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="form-group" id="divnsm">
                            <label for="inputPassword3" class="col-sm-4 control-label">NSM</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.NSMID, new SelectList(ViewBag.UserByRoleNSM, "UserID", "UserFullName", Session["UserID"]), "Select NSM", new { @class = "form-control" })                           
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group" id="divzsm">
                            <label for="inputPassword3" class="col-sm-4 control-label">ZSM</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.ZSMID, new SelectList(ViewBag.UserByRoleZSM, "UserID", "UserFullName", Session["UserID"]), "Select ZSM", new { @class = "form-control" })                              
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="form-group" id="divrsm">
                            <label for="inputPassword3" class="col-sm-4 control-label">RSM</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.RSMID, new SelectList(ViewBag.UserByRoleRSM, "UserID", "UserFullName", Session["UserID"]), "Select RSM", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group" id="divasm">
                            <label for="inputPassword3" class="col-sm-4 control-label">ASM</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.ASMID, new SelectList(ViewBag.UserByRoleASM, "UserID", "UserFullName",Session["UserID"]), "Select ASM", new { @class = "form-control" })
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="form-group" id="divmr">
                            <label for="inputPassword3" class="col-sm-4 control-label">MR</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.MRID, new SelectList(ViewBag.UserByRoleMR, "UserID", "UserFullName", Session["UserID"]), "Select MR", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group" id="divproduct">
                            <label for="inputPassword3" class="col-sm-4 control-label">Product</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.ProductId, new SelectList(ViewBag.Product, "ProductId", "ProductName"), "Select Product", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="form-group" id="divproductdivision">
                            <label for="inputPassword3" class="col-sm-4 control-label">Product Division</label>
                            <div class="col-sm-8">
                                <select name="CaseName" id="CaseName" class="form-control" >
                                    <option value="" selected>Select Division</option>
                                    <option value="1">Blaze</option>
                                    <option value="2">Magnar</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group" id="divarea">
                            <label for="inputPassword3" class="col-sm-4 control-label">Area</label>
                            <div class="col-sm-8">
                                @Html.DropDownListFor(m => m.AreaID, new SelectList(ViewBag.Area, "AreaID", "AreaName"), "Select Area", new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="form-group">
                            <label for="AssignedDate" class="col-sm-4 control-label">From</label>
                            <div class="col-sm-8">
                                <div class="input-group date">
                                    <div class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right datepicker" id="txtfrom"  >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-5">
                        <div class="form-group">
                            <label for="AssignedDate" class="col-sm-4 control-label">To</label>
                            <div class="col-sm-8">
                                <div class="input-group date">
                                    <div class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                    <input type="text" class="form-control pull-right datepicker" id="txtTo" >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="box-footer ">
            <div class="pull-right">
                <button type="button" id="btncancel" class="btn btn-default">Cancel</button>
                <button type="button" id="btnsearch" class="btn btn-info">Search</button>
            </div>
        </div>
    </form>

    <div id="lstSales">

    </div>
</div>

<script src="~/Scripts/jquery-1.10.2.js"></script>
<script>

    $(document).ready(function () {

        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetAllDirector")',
            dataType: 'json',
            success: function (data) {
                //debugger;
                $('#DirectorID').find('option').remove().end().append('<option value="0">Select Director</option>').val('select');
                $.each(data, function (key, value) {
                    $('#DirectorID')
                       .append($("<option></option>")
                                  .attr("value", value.UserID)
                                  .text(value.UserFullName)
                                  .attr("data-Director", value.UserID));               

                });
            }
        });

      
        $("#DirectorID").change(function () {
            debugger;
            var DirectorID = $("#DirectorID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetVPByDirectorReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID },
                success: function (data) {
                    var district = "<select class='form-control'>";
                    district = district + '<option value="0">Select VP</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#VPID').html(district);
                    $('#DirectorID').val(DirectorID);                    
                    var UserID = '@Session["UserID"]';                 
                   // $('#VPID').val(UserID).trigger('change');
                    GetUserDetailsForReports(UserID);
                }
            });
        });

        $("#VPID").change(function () {           
            debugger;           
            var DirectorID = $("#DirectorID").val();            
            var VPID = $("#VPID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetNSMByVPIDReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID, VPID: VPID },
                success: function (data) {
                    var district = "<select id='NSMID'>";
                    district = district + '<option value="">Select NSM</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#NSMID').html(district);
                    $('#VPID').val(VPID);
                    var UserID = '@Session["UserID"]';
                    GetUserDetailsForReports(UserID);
                    //$('#NSMID').val(UserID).trigger('change');
                }
            });
        });

        $("#NSMID").change(function () {          
            var DirectorID = $("#DirectorID").val();
            var VPID = $("#VPID").val();
            var NSMID = $("#NSMID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetZSMByNSMIDReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID, VPID: VPID, NSMID: NSMID },
                success: function (data) {
                    var district = "<select id='ZSMID'>";
                    district = district + '<option value="">Select ZSM</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#ZSMID').html(district);
                    $('#NSMID').val(NSMID);
                    var UserID = '@Session["UserID"]';
                    //$('#ZSMID').val(UserID).trigger('change');
                    GetUserDetailsForReports(UserID);
                }
            });
        });


        $("#ZSMID").change(function () {          
            var DirectorID = $("#DirectorID").val();
            var VPID = $("#VPID").val();
            var NSMID = $("#NSMID").val();
            var ZSMID = $("#ZSMID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetRSMByZSMIDReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID, VPID: VPID, NSMID: NSMID, ZSMID: ZSMID },
                success: function (data) {
                    var district = "<select id='RSMID'>";
                    district = district + '<option value="">Select RSM</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#RSMID').html(district);
                    $('#ZSMID').val(ZSMID);
                    var UserID = '@Session["UserID"]';
                    //$('#RSMID').val(UserID).trigger('change');
                    GetUserDetailsForReports(UserID);
                }
            });
        });


        $("#RSMID").change(function () {          
            var DirectorID = $("#DirectorID").val();
            var VPID = $("#VPID").val();
            var NSMID = $("#NSMID").val();
            var ZSMID = $("#ZSMID").val();
            var RSMID = $("#RSMID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetASMByRSMIDReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID, VPID: VPID, NSMID: NSMID, ZSMID: ZSMID, RSMID: RSMID },
                success: function (data) {
                    var district = "<select id='ASMID'>";
                    district = district + '<option value="">Select ASM</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#ASMID').html(district);
                    $('#RSMID').val(RSMID);
                    var UserID = '@Session["UserID"]';
                    //$('#ASMID').val(UserID).trigger('change');
                    GetUserDetailsForReports(UserID);
                }
            });
        });

        $("#ASMID").change(function () {          
            var DirectorID = $("#DirectorID").val();
            var VPID = $("#VPID").val();
            var NSMID = $("#NSMID").val();
            var ZSMID = $("#ZSMID").val();
            var RSMID = $("#RSMID").val();
            var ASMID = $("#ASMID").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetMRByASMIDReport")',
                dataType: 'json',
                data: { DirectorID: DirectorID, VPID: VPID, NSMID: NSMID, ZSMID: ZSMID, RSMID: RSMID, ASMID: ASMID },
                success: function (data) {
                    var district = "<select id='MRID'>";
                    district = district + '<option value="">Select MR</option>';
                    for (var i = 0; i < data.length; i++) {
                        district = district + '<option value=' + data[i].UserID + '>' + data[i].UserFullName + '</option>';
                    }
                    district = district + '</select>';
                    $('#MRID').html(district);
                    $('#ASMID').val(ASMID);
                    var UserID = '@Session["UserID"]';
                    //$('#MRID').val(UserID).trigger('change');
                    GetUserDetailsForReports(UserID);
                }
            });
        });

        debugger;
        var UserID = '@Session["UserID"]';
        var data = GetUserDetailsForReports(UserID);
      

    });

    function GetUserDetailsForReports(UserID) {
        debugger;
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetUserDetailsForReports")',
            dataType: 'json',
            data: { UserID: UserID },
            success: function (data) {
              
                var RoleID = '@Session["RoleID"]';
                if (RoleID == 1) {
                    $("#DirectorID").val(data.UserID);
                    $("#divdirctor").show();
                    $("#divvp").show();                    
                    $("#divnsm").show();                    
                    $("#divzsm").show();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 2) {
                    $("#DirectorID").val(data.DirectorID).trigger('change');
                    $("#VPID").val(data.VPID).trigger('change');
                    $("#divdirctor").hide();
                    $("#divvp").show();
                    $("#divnsm").show();
                    $("#divzsm").show();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 3) {
                  
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").show();
                    $("#divnsm").show();
                    $("#divzsm").show();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();

                }

                else if (RoleID == 4) {
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.VPID);
                    $("#NSMID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").show();
                    $("#divzsm").show();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 5) {
                  
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.VPID);
                    $("#NSMID").val(data.NSMID);
                    $("#ZSMID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").hide();
                    $("#divzsm").show();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 6) {
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.VPID);
                    $("#NSMID").val(data.NSMID);
                    $("#ZSMID").val(data.ZSMID);
                    $("#RSMID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").hide();
                    $("#divzsm").hide();
                    $("#divrsm").show();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 7) {
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.VPID);
                    $("#NSMID").val(data.NSMID);
                    $("#ZSMID").val(data.ZSMID);
                    $("#RSMID").val(data.RSMID);
                    $("#ASMID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").hide();
                    $("#divzsm").hide();
                    $("#divrsm").hide();
                    $("#divasm").show();
                    $("#divmr").show();
                }

                else if (RoleID == 8) {
                    $("#DirectorID").val(data.DirectorID);
                    $("#VPID").val(data.VPID);
                    $("#NSMID").val(data.NSMID);
                    $("#ZSMID").val(data.ZSMID);
                    $("#RSMID").val(data.RSMID);
                    $("#ASMID").val(data.ASMID);
                    $("#MRID").val(data.UserID);
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").hide();
                    $("#divzsm").hide();
                    $("#divrsm").hide();
                    $("#divasm").hide();
                    $("#divmr").show();
                }

                else {
                    //$("#DirectorID").val(data.DirectorID).trigger('change');
                    //$("#VPID").val(data.VPID).trigger('change');
                    //$("#NSMID").val(data.NSMID).trigger('change');
                    //$("#ZSMID").val(data.ZSMID).trigger('change');
                    //$("#RSMID").val(data.RSMID).trigger('change');
                    //$("#ASMID").val(data.ASMID).trigger('change');
                    //$("#MRID").val(data.MRID).trigger('change');
                    $("#divdirctor").hide();
                    $("#divvp").hide();
                    $("#divnsm").hide();
                    $("#divzsm").hide();
                    $("#divrsm").hide();
                    $("#divasm").hide();
                    $("#divmr").hide();
                }
                return data;
            }
        });
    }

    function loadhtml() {
      
        var model = new Object();
        model.StartDate = $("#txtfrom").val();
        model.EndDate = $("#txtTo").val();
        model.RoleID = '@Session["RoleID"]';
        // model.RoleID = $("#UserRoleID").val();
        // model.UserName = '@Session["Username"]';
        model.DirectorID = $("#DirectorID").val();
        model.VPID = $("#VPID").val();
        model.NSMID = $("#NSMID").val();
        model.ZSMID = $("#ZSMID").val();
        model.RSMID = $("#RSMID").val();
        model.ASMID = $("#ASMID").val();
        model.MRID = $("#MRID").val();
      

        if ((model.NSMID == "0") || (model.NSMID == "")) {
            model.Id = $("#VPID").val();
            model.UserName = $("#VPID :selected").text();
        }
        else if ((model.ZSMID == "0") || (model.ZSMID == "")) {
            model.Id = $("#NSMID").val();
            model.UserName = $("#NSMID :selected").text();
        }
        else if ((model.RSMID == "0") || (model.RSMID == "")) {
            model.Id = $("#ZSMID").val();
            model.UserName = $("#ZSMID :selected").text();
        }
        else if ((model.ASMID == "0") || (model.ASMID == "")) {
            model.Id = $("#RSMID").val();
            model.UserName = $("#RSMID :selected").text();
        }
        else if ((model.MRID == "") || (model.MRID == "0")) {
            model.Id = $("#ASMID").val();
            model.UserName = $("#ASMID :selected").text();
        }
        else {
            model.Id = $("#MRID").val();
            model.UserName = $("#MRID :selected").text();
        }
        //model.Id = $("#Id").val();
        model.ProductId = $("#ProductId").val();
        model.CaseName = $("#CaseName").val();
        model.AreaID = $("#AreaID").val();
        $.ajax({
            url: '@Url.Action("SalesReportList")',
            type: 'POST',
            data: { 'model': model },
            cache: false,
        }).done(function (result) {
            $('#lstSales').html(result);
        });
    }

    $("#btnsearch").click(function () {
        loadhtml();
    });

    $("#btncancel").click(function () {
        clearform();
    });
    function clearform() {
        $("#frmsalesreport").find("input").val("");
        $("#DirectorID").val("").trigger("change");
        $("#VPID").val("").trigger("change");
        $("#NSMID").val("").trigger("change");
        $("#ZSMID").val("").trigger("change");
        $("#RSMID").val("").trigger("change");
        $("#ASMID").val("").trigger("change");
        $("#MRID").val("").trigger("change");
        $("#ProductId").val("").trigger("change");
        $("#CaseName").val("").trigger("change");
        $("#AreaID").val("").trigger("change");
    }

</script>


